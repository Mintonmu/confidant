/**
 * 企业用户填写公司信息
 * 第一步：
 *      填写基本信息
 */
$(function () {
    var b, c, a = !1;
    window.onbeforeunload = function () {}, $("#stepTip a").bind("click", function () {
        $(this).parent("#stepTip").remove()
    }), b = {expires: 1}, null == $.cookie("viewTimes") ? ($("#stepTip img").attr("src", ctx + "/images/tiponce.jpg").parent("#stepTip").fadeIn(200), $.cookie("viewTimes", "1", b)) : (c = parseInt($.cookie("viewTimes")) + 1, $("#stepTip img").attr("src", ctx + "/images/tipagain.jpg").parent("#stepTip").fadeIn(200), $.cookie("viewTimes", c, b)), $(document).click(function () {
        var a = [];
        $("#box_industry li.current").length > 2 ? alert("行业领域最多可选2个") : ($("#box_industry li.current").each(function () {
            a.push($(this).text())
        }), "" == a.join() ? $("#select_industry").val("请选择行业领域") : $("#select_industry").val(a.join()), $("#select_industry_hidden").val(a.join()), $("#box_industry").hide()), $("#box_industry").hide(), $("#box_scale").hide(), $("#stagesList .box_invest").hide()
    }), $("#select_industry").bind("click", function (a) {
        a.stopPropagation(), $("#box_industry").show(), $("#box_scale").hide(), $("#stagesList .box_invest").hide()
    }), $("#box_industry").on("click", "ul li", function (a) {
        a.stopPropagation();
        var b = [];
        $(this).hasClass("current") ? ($(this).removeClass("current"), $("#box_industry li.current").each(function () {
            b.push($(this).text())
        }), $("#select_industry").val(b.join()), $("#select_industry_hidden").val(b.join())) : 0 == $(this).siblings("li.current").length ? ($(this).addClass("current"), b.push($(this).text()), $("#select_industry").val(b.join()), $("#select_industry_hidden").val(b.join())) : 1 == $(this).siblings("li.current").length ? ($(this).addClass("current"), $("#box_industry li.current").each(function () {
            b.push($(this).text())
        }), $("#select_industry").val(b.join()), $("#select_industry_hidden").val(b.join()), $("#box_industry").hide()) : $(this).siblings("li.current").length >= 2 && alert("行业领域最多可选2个"), $("#stepForm").validate().element("#select_industry_hidden")
    }), $("#select_scale").bind("click", function (a) {
        a.stopPropagation(), $("#box_scale").show(), $("#box_industry").hide(), $("#stagesList .box_invest").hide()
    }), $("#box_scale").on("click", "ul li", function (a) {
        a.stopPropagation();
        var b = $(this).text();
        $("#select_scale,#select_scale_hidden").val(b), $("#box_scale").hide(), $("#stepForm").validate().element("#select_scale_hidden")
    }), $("#box_industry,#box_scale").bind("click", function (a) {
        a.stopPropagation()
    }), $(".s_radio li").click(function () {
        var b = $(this).text();
        $("#s_radio_hidden").val(b), $(this).addClass("current").append("<em></em>").siblings().removeClass("current").find("em").remove(), $("#stepForm").validate().element("#s_radio_hidden")
    }), $("#stagesList").on("click", ".select_invest", function (a) {
        a.stopPropagation(), $("#box_scale").hide(), $("#box_industry").hide(), $(this).parents("li").siblings().children(".box_invest").hide(), $(this).siblings(".box_invest").show()
    }), $("#stagesList").on("click", ".box_invest li", function (a) {
        var b, c;
        a.stopPropagation(), b = $(this).html(), c = $(this).parents("li"), $(".select_invest,.select_invest_hidden", c).val(b), $(this).parents(".box_invest").hide(), c.index() == $("#stagesList > li").length - 1 && $("#stagesList > li").length < 10 && c.children(".select_invest").trigger("change")
    }), $("#stagesList").on("change", ".select_invest", function () {
        var a = $("#cloneInvest").html();
        $("#stagesList").append("<li>" + a + "</li>")
    })
});

//校验url是否合法
function isURL(str_url) {// 验证url
    var strRegex = "^((https|http|ftp|rtsp|mms)?://)"
        + "?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?" // ftp的user@
        + "(([0-9]{1,3}\.){3}[0-9]{1,3}" // IP形式的URL- 199.194.52.184
        + "|" // 允许IP和DOMAIN（域名）
        + "([0-9a-z_!~*'()-]+\.)*" // 域名- www.
        + "([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\." // 二级域名
        + "[a-z]{2,6})" // first level domain- .com or .museum
        + "(:[0-9]{1,4})?" // 端口- :80
        + "((/?)|" // a slash isn't required if there is no file name
        + "(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$";
    var re = new RegExp(strRegex);
    return re.test(str_url);
}

//点击下一步按钮
$("#hidden_submit").click(function () {
    //获取公司名称
    var companyName = $("#name").val().trim();
    //获取公司logo
    var companyLogo=$("#select_btn").attr("src");
    //获取公司网址
    var companyUrl = $("#website").val().trim();
    //获取公司所在城市
    var companyCity = $("#city").val().trim();
    //获取行业领域
    var companyField=$("#select_industry_hidden").val().trim();
    //获取公司规模
    var companyScale=$("#select_scale_hidden").val().trim();
    //获取公司发展阶段
    var companyStage=$("#s_radio_hidden").val().trim();
    //获取公司愿景
    var reserved2=$("#temptation").val();
    //获取当前登陆的用户ID
    var userId=$("#userId").val();

    // console.log("公司名称："+companyName);
    // console.log("公司LOGO："+companyLogo);
    // console.log("公司网址："+companyUrl);
    // console.log("公司所在城市："+companyCity);
    // console.log("公司行业领域："+companyField);
    // console.log("公司规模："+companyScale);
    // console.log("发展阶段："+companyStage);
    //数据校验
    if(companyName==""||companyName==null){
        layer.msg("请输入公司名称！");
        return false;
    }

    if(companyLogo=="style/images/upload.png"){
        layer.msg("请上传公司logo！");
        return false;
    }

    if(companyUrl==""||companyUrl==null){
        layer.msg("请输入公司网址！");
        return false;
    }
    if(!isURL(companyUrl)){
        layer.msg("输入的网址格式不正确！");
        return false;
    }
    if(companyCity==""||companyCity==null){
        layer.msg("请输入公司所在城市！");
        return false;
    }
    if(companyField==""||companyField==null){
        layer.msg("请输入公司所属的行业领域！");
        return false;
    }
    if(companyScale==""||companyScale==null){
        layer.msg("请输入公司规模！");
        return false;
    }
    if(companyStage==""||companyStage==null){
        layer.msg("请输入公司发展阶段！");
        return false;
    }
    if(reserved2==""||reserved2==null){
        layer.msg("请输入公司愿景！");
        return false;
    }
    if(reserved2.length>50){
        layer.msg("公司愿景字数限制在50字以内！");
        return false;
    }

    if(userId==""||userId==null){
        layer.layer("请前往登陆！",function () {
            location.href="/loginPage";
        });
        return false;
    }

    //数据校验通过，则向后台发送请求
    $("#stepBtn").click();
})
