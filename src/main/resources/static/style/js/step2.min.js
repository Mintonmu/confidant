/**
 * 企业用户填写公司信息
 * 第二步：
 *      填写标签
 */
$(function () {
    $("#labels").on("mouseenter", "li", function () {
        $(this).find("i").addClass("visible")
    }), $("#labels").on("mouseleave", "li", function () {
        $(this).find("i").removeClass("visible")
    }), $("#labels").on("click", "li i", function () {
        var a = $(this).prev("span").text();
        $("#box_labels dl").each(function () {
            $("li.selected", this).each(function () {
                $(this).text() == a && $(this).removeClass("selected")
            })
        }), $(this).parents("li").remove()
    }), $("#add_label").bind("click", function () {
        var a = $("#label"), b = $.trim(a.val()), c = !0;
        b.length <= 6 && b.length > 0 ? ($("#labels li").each(function () {
            $("span", this).text() == b && (c = !1)
        }), c ? $("#labels").append("<li><span>" + b + "</span><i></i></li>") : layer.alert("此标签已存在，请从新输入")) : layer.alert("请输入1-6字的自定义标签"), a.val("")
    }), $("#label").keydown(function (a) {
        13 == a.which && (a.stopPropagation(), $("#add_label").trigger("click"))
    }), $("#box_labels").on("click", "li", function () {
        if (!$(this).hasClass("selected")) {
            $(this).addClass("selected");
            var a = $(this).text();
            $("#labels").append("<li><span>" + a + "</span><i></i></li>")
        }
    }), $("#step2Submit").click(function () {
        //获取当前登陆用户ID
        var userId=$("#userId").val();
        console.log("当前登陆的用户ID："+userId);
        //判断用户是否登陆
        if(userId==""||userId==null){
            layer.alert("权限不足！",function () {
                location.href="/loginPage";
            });
            return false;
        }


        var a = [], b = $("#companyId").val();
        $("#labels li").each(function () {
            a.push($(this).children("span").text())
        }),
            console.log("选择的标签："+a.join());
            if(a.join()==""||a.join()==null){
                //未选择标签
                layer.msg("请选择至少一个标签！");
                return false;
            }
            if(a.length>3){
                layer.msg("最多选择三个标签！");
                return false;
            }


            $.ajax({
            type: "POST",
            data: {companyId: b, labels: a.join()},
            url:"/saveTags",
            success:function (result) {
                //成功的回调
                if(result.code==0){
                    //跳转到公司认证第三步 公司创始人
                    location.href="/founder";
                    return false;
                }else if(result.code==1){
                    layer.alert("标签设置失败！请重试！",{icon:5});
                    return false;
                }else{
                    layer.msg("系统异常，请稍后再试");
                    return false;
                }
            }
        })
    })
});
