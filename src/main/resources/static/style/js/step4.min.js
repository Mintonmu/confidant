//function img_check(a,b,c,d,e,f,g,h,i,j,k){var l=$("#"+j).val();a=$("#"+f),this.AllowExt=".jpg,.gif,.jpeg,.png,.pjpeg",this.FileExt=a.val().substr(a.val().lastIndexOf(".")).toLowerCase(),0!=this.AllowExt&&-1==this.AllowExt.indexOf(this.FileExt)?$("#"+g).text("只支持jpg、gif、png、jpeg格式，请重新上传").show():($("#"+g).text("").hide(),$.ajaxFileUpload({url:b,secureuri:!1,fileElementId:f,data:{type:l},dataType:"text",success:function(a){""!=a?($("#"+k).val(a),$("#"+i+" img").attr("src",ctx+"/"+a),$("#"+h).hide(),$("#"+i).show()):$("#"+g).text("上传失败，请重新上传").show()},error:function(){$("#"+g).text("上传失败，请重新上传").show()}}))}$(function(){$("#addMember").click(function(){var a=$(".formWrapper").length,b=$("#companyId").val();2==a&&$(this).hide(),$("#productDiv").append('<div class="formWrapper"><input type="hidden" name="productInfos['+a+'].companyId" value="'+b+'" />'+"<h3>产品海报</h3>"+'<div class="new_product mt20">'+'<div class="product_upload" id="productNo'+a+'">'+"<div><span>上传产品图片</span> <br />	尺寸：380*220px  	大小：小于5M</div>"+"</div>"+'<div class="product_upload dn productShow" id="productShow'+a+'">'+'<img src="" width="380" height="220" />'+"<span>更换产品图片<br />380*220px 小于5M</span>"+"</div>"+'<input type="file" id="myfiles'+a+'" name="myfiles" onchange="img_check(this,\''+ctx+"/c/upload.json',380,220,5,'myfiles"+a+"','myfiles"+a+"_error','productNo"+a+"','productShow"+a+"','type"+a+"','productInfos"+a+'\');" title="支持jpg、jpeg、gif、png格式，文件小于5M" />'+'<input type="hidden" id="type'+a+'" name="productInfos['+a+'].type" value="3" /> '+'<input type="hidden" id="productInfos'+a+'" name="productInfos['+a+'].productPicUrl" />'+"</div>"+'<span class="error" id="myfiles'+a+'_error" style="display:none;"></span>'+"<h3>产品名称</h3>"+'<input type="text" id="name'+a+'" name="productInfos['+a+'].product" placeholder="请输入产品名称" />'+"<h3>产品地址</h3>"+'<input type="text" id="address'+a+'" name="productInfos['+a+'].productUrl" placeholder="请输入产品主页URL或产品下载地址" />'+"<h3>产品简介</h3>"+'<textarea id="description'+a+'" name="productInfos['+a+'].productProfile" maxlength="1000" placeholder="请输入该创始人的个人履历等，建议按照时间倒序分条展示"></textarea>'+'<div class="word_count">你还可以输入 <span>500</span> 字</div>'+"</div>"),$(".formWrapper").each(function(b){b!=a&&$(this).css({borderBottom:"1px solid #555",paddingBottom:"20px"})})}),$("#productDiv").on("keyup","textarea",function(){var a=$(this);a.val().length>500?a.val(a.val().substring(0,500)):a.siblings(".word_count").children("span").text(500-a.val().length)}),$("#productForm").on("mouseenter",".new_product input",function(){$(".product_upload div").css("backgroundColor","#7e9597")}),$("#productForm").on("mouseleave",".new_product input",function(){$(".product_upload div").css("backgroundColor","#93b7bb")}),$("#productForm").validate({onkeyup:!1,focusCleanup:!0,rules:{"productInfos[0].product":{required:!1,minlength:2,maxlenStr:20},"productInfos[0].productUrl":{required:!1,checkUrlNot:!0,maxlength:120},"productInfos[0].productProfile":{required:!1,specialchar:!0,checkNum:!0,minlength:10,maxlength:500},"productInfos[1].product":{required:!1,minlength:2,maxlenStr:20},"productInfos[1].productUrl":{required:!1,checkUrlNot:!0,maxlength:120},"productInfos[1].productProfile":{required:!1,specialchar:!0,checkNum:!0,minlength:10,maxlength:500},"productInfos[2].product":{required:!1,minlength:2,maxlenStr:20},"productInfos[2].productUrl":{required:!1,checkUrlNot:!0,maxlength:120},"productInfos[2].productProfile":{required:!1,specialchar:!0,checkNum:!0,minlength:10,maxlength:500}},messages:{"productInfos[0].product":{minlength:"请输入有效的产品名称",maxlenStr:"请输入有效的产品名称"},"productInfos[0].productUrl":{checkUrlNot:"请输入有效的产品主页或产品下载地址",maxlength:"请输入120字符以内的网址"},"productInfos[0].productProfile":{specialchar:"请输入有效的产品简介",checkNum:"请输入有效的产品简介",minlength:"请输入10-500字的产品简介",maxlength:"请输入10-500字的产品简介"},"productInfos[1].product":{minlength:"请输入有效的产品名称",maxlenStr:"请输入有效的产品名称"},"productInfos[1].productUrl":{checkUrlNot:"请输入有效的产品主页或产品下载地址",maxlength:"请输入120字符以内的网址"},"productInfos[1].productProfile":{specialchar:"请输入有效的产品简介",checkNum:"请输入有效的产品简介",minlength:"请输入10-500字的产品简介",maxlength:"请输入10-500字的产品简介"},"productInfos[2].product":{minlength:"请输入有效的产品名称",maxlenStr:"请输入有效的产品名称"},"productInfos[2].productUrl":{checkUrlNot:"请输入有效的产品主页或产品下载地址",maxlength:"请输入120字符以内的网址"},"productInfos[2].productProfile":{specialchar:"请输入有效的产品简介",checkNum:"请输入有效的产品简介",minlength:"请输入10-500字的产品简介",maxlength:"请输入10-500字的产品简介"}},submitHandler:function(a){var b=$(a).find('input[type="text"]'),c=$(a).find("textarea");b.each(function(){$(this).val()==$(this).attr("placeholder")&&$(this).val("")}),c.each(function(){$(this).text()==$(this).attr("placeholder")&&$(this).text("")}),$(a).find(":submit").attr("disabled",!0),a.submit()}})});
/**
 * 企业用户填写公司信息
 * 第四步：
 *      填写产品
 */

//校验url是否合法
function isURL(str_url) {// 验证url
    var strRegex = "^((https|http|ftp|rtsp|mms)?://)"
        + "?(([0-9a-z_!~*'().&=+$%-]+: )?[0-9a-z_!~*'().&=+$%-]+@)?" // ftp的user@
        + "(([0-9]{1,3}\.){3}[0-9]{1,3}" // IP形式的URL- 199.194.52.184
        + "|" // 允许IP和DOMAIN（域名）
        + "([0-9a-z_!~*'()-]+\.)*" // 域名- www.
        + "([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\." // 二级域名
        + "[a-z]{2,6})" // first level domain- .com or .museum
        + "(:[0-9]{1,4})?" // 端口- :80
        + "((/?)|" // a slash isn't required if there is no file name
        + "(/[0-9a-z_!~*'().;?:@&=+$,%#-]+)+/?)$";
    var re = new RegExp(strRegex);
    return re.test(str_url);
}

//点击下一步按钮，触发事件
$("#hiddenSubmit").click(function(){
    //获取公司ID
    var companyId=$("#companyId").val();
    //获取当前登陆用户ID
    var userId=$("#userId").val();
    //获取产品海报
    var productLogo=$("#select_btn").attr("src");
    //获取产品名称
    var productName=$("#name0").val();
    //获取产品地址
    var productUrl=$("#address0").val();
    //获取产品简介
    var productDescribe=$("#description0").val();

    console.log("获取公司ID:"+companyId);
    console.log("获取当前登陆用户ID:"+userId);
    console.log("获取产品海报:"+productLogo);
    console.log("获取产品名称:"+productName);
    console.log("获取产品地址:"+productUrl);
    console.log("获取产品简介:"+productDescribe);

    //数据校验
    if(companyId==""||companyId==null||userId==""||userId==null){
        layer.alert("权限不足！",{icon:4});
        return false;
    }

    if(productLogo=="style/images/upload_product.png"){
        layer.alert("请上传产品logo！",{icon:2});
        return false;
    }
    if(productName==""||productName==null){
        layer.alert("请输入产品名称！",{icon:2});
        return false;
    }
    if(productUrl==""||productUrl==null){
        layer.alert("请输入产品网址！",{icon:2});
        return false;
    }
    if(!isURL(productUrl)){
        layer.alert("输入的网址格式不正确！",{icon:2});
        return false;
    }
    if(productDescribe==""||productDescribe==null){
        layer.alert("请输入产品介绍！",{icon:2});
        return false;
    }

    //数据校验通过，发送请求
    $("#step4Submit").click();


});